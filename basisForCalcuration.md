## 📈 주식 랭킹 데이터프레임 분석 (`full`, `financial`, `surge`)

형, 요청한 코드가 생성하는 세 가지 주요 데이터프레임이 어떤 기준으로 주식 종목을 필터링하고 정렬하는지 자세히 알려줄게.

---

### 1. `full` (전체 상위 종합 랭킹)

이 데이터프레임은 **가장 광범위한 랭킹**을 보여줘. 각 종목별로 계산된 다양한 지표들(`PER`, `ROE`, `RSI`, `MACD`, `Bollinger Bands %B`, `외국인 보유율` 등)을 종합적으로 고려한 **종합 점수(`score`)**를 기준으로 내림차순 정렬한 결과야.

* **산출 근거 지표:**
    * **PER 점수:** PER이 낮을수록 높은 점수를 받도록 설계되었어 (예: `1/PER * 100`). 단, PER이 0 이하이거나 너무 높으면 특정 값으로 처리돼.
    * **ROE 점수:** ROE가 높을수록 높은 점수를 받아 (예: `ROE / 20`).
    * **RSI 점수:** RSI가 30 미만(과매도)일 경우 1점, 70 초과(과매수)일 경우 0점, 그 외에는 0.5점을 부여해. 과매도 상태에서 회복 가능성을 높게 보는 거지.
    * **MACD 점수:** **골든 크로스**가 발생하면 1점, 아니면 0점을 부여해.
    * **Bollinger Bands %B 점수:** `percent_b` 값을 그대로 사용해서 밴드 하단에 가까울수록 낮은 점수, 상단에 가까울수록 높은 점수를 가져 (0에 가까울수록 과매도권).
    * **외국인 보유율 점수:** 외국인 보유율이 5% 이상일 경우 1점, 아니면 0점을 부여해.

* **가중치 및 정규화:** 위에서 언급된 각 지표의 "원시 점수"(`_raw_metrics`)들은 `MinMaxScaler`를 통해 0과 1 사이로 **정규화**되고, 다음 가중치를 곱하여 최종 `score`를 산출해:
    * PER: 0.2
    * ROE: 0.2
    * RSI: 0.15
    * MACD: 0.15
    * Bollinger Bands %B: 0.1
    * 외국인 보유율: 0.2
    이 가중치들을 통해 재무 지표(PER, ROE), 기술적 지표(RSI, MACD, BB), 그리고 수급 지표(외국인 보유율)가 종합적으로 평가되어 최종 `score`가 결정돼.

---

### 2. `financial` (재무 건전성 우수 종목)

이 데이터프레임은 `full` 데이터프레임에서 특정 **재무 건전성 조건을 만족하는 종목만 필터링**한 결과야.

* **산출 근거 지표 및 필터링 기준:**
    * **PER < 30:** 주가수익비율(PER)이 30보다 낮은 종목 (저평가 또는 합리적인 평가를 받는 기업 선호).
    * **ROE > 5:** 자기자본이익률(ROE)이 5보다 높은 종목 (자본을 효율적으로 사용하여 이익을 내는 기업 선호).
* **정렬 기준:** 필터링된 종목들을 **ROE (내림차순), PER (오름차순), 종합 점수(`score`) (내림차순)** 순으로 정렬하여, 재무적으로 탄탄하고 효율적인 기업들을 우선적으로 보여줘.

---

### 3. `surge` (급등 가능성 종목)

이 데이터프레임은 종목별 **급등 가능성 점수(`급등_점수`)를 기준으로 정렬**한 결과야. 특정 필터링 조건 없이 모든 종목의 급등 점수를 기준으로 순위를 매겨 보여주지.

* **산출 근거 지표:** 각 종목에 대해 계산되는 **`surge_score`**를 기반으로 해. `surge_score`는 10점 만점 기준으로 여러 기술적 지표와 수급 지표의 현재 상태에 따라 점수가 부여돼. 각 시그널이 강할수록 더 높은 점수를 받고, 해당 시그널에 대한 설명도 `급등_시그널` 컬럼에 제공돼.
    * **RSI 점수 (최대 2.5점):** RSI가 과매도권에서 회복하거나 50 이상으로 돌파할 때 점수 부여.
    * **MACD 점수 (최대 2.5점):** MACD 골든 크로스 발생 및 0선 돌파 시 점수 부여.
    * **볼린저밴드 점수 (최대 2점):** 주가가 볼린저밴드 하단에서 회복하거나 중간선을 돌파할 때, 또는 밴드가 수렴 후 확장될 때 점수 부여.
    * **거래량 점수 (최대 2.5점):** 20일 평균 거래량 대비 현재 거래량의 급증 정도에 따라 점수 부여. 특히 상승 추세에서의 거래량 급증에 높은 점수를 줘.
    * **외국인 수급 점수 (최대 1.5점):** 외국인 보유율이 5%, 10%, 20% 이상으로 높을수록 점수 부여.

* **정렬 기준:** 오로지 **`급등_점수` (내림차순)**를 기준으로 정렬하여, 기술적인 급등 시그널이 강하게 나타나는 종목들을 우선적으로 보여줘.

---

**요약하자면:**

* **`full`**: 여러 지표를 종합하여 최종 점수를 매긴 전체 랭킹.
* **`financial`**: 재무 건전성(PER, ROE) 조건을 만족하는 종목 중 재무 지표와 종합 점수를 고려한 랭킹.
* **`surge`**: 기술적 시그널 및 수급을 바탕으로 급등 가능성 점수가 높은 종목 랭킹.

